<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numbers3 Neural Equation Solver</title>
    <!-- ルートに移動したため、assets を public/ パスに修正 -->
    <link rel="stylesheet" href="public/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>NUMBERS3 <span class="accent">EQUATION SOLVER</span></h1>
            <div class="api-box">
                <div style="display:flex; flex-wrap:wrap; gap:6px; align-items:center;">
                    <input type="password" id="apiKey" placeholder="Gemini API Keyを入力">
                    <button id="saveKey">Key保存</button>
                    <button id="fetchModelsBtn">モデル取得</button>
                    <select id="modelSelect" style="min-width:140px;">
                        <option value="gemini-1.5-flash">gemini-1.5-flash</option>
                    </select>
                </div>
                <div id="modelInfo" style="font-size:0.75rem; opacity:0.8; margin-top:4px;"></div>
            </div>
        </header>

        <main>
            <section class="card">
                <h2>1. Historical Analysis & Reverse Engineering</h2>
                <p>過去データから「当選数字を導き出すための方程式（係数）」を逆算し、その推移を解析します。</p>

                <div style="margin-bottom:10px; font-size:0.85rem;">
                    <p style="margin:0 0 4px 0; opacity:0.9;">① <code>public/data.json</code> のデータを使う</p>
                    <p style="margin:0 0 4px 0; opacity:0.9;">② または、下のテキストエリアに次の形式で貼り付けて解析:</p>
                    <pre style="margin:4px 0 6px 0; padding:6px; background:#000; border-radius:4px; font-size:0.8rem;">
0001	1994-10-07	191
0002	1994-10-14	988
0003	1994-10-21	194</pre>
                    <textarea id="manualDataInput" placeholder="回号[TAB]YYYY-MM-DD[TAB]当選番号(3桁) ..." style="width:100%; min-height:70px; padding:6px; box-sizing:border-box; font-size:0.8rem;"></textarea>
                </div>

                <button id="analyzeBtn" class="primary-btn">データ解析・逆算開始</button>
                <div class="chart-container">
                    <canvas id="coeffChart"></canvas>
                </div>
            </section>

            <section class="card">
                <h2>2. AI Inference (Gemini)</h2>
                <p>係数の変動パターン（ゆらぎ）をAIが読み解き、次回の方程式を決定します。APIキー入力後、「モデル取得」で利用可能なGeminiモデルを一覧から選択できます。</p>
                <button id="predictBtn" class="secondary-btn" disabled>Geminiに予測させる</button>
                <div id="tokenEstimate" style="font-size:0.8rem; opacity:0.85; margin-top:6px;"></div>
                
                <div id="resultArea" class="result-box hidden">
                    <h3>Prediction Result</h3>
                    <div id="output" class="console-text"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- JSも public/ 配下から読み込む -->
    <script type="module" src="public/js/app.js"></script>
</body>
</html>